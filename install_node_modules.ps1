function Install-Yarn-Recursive () {
    param ($dir)

    if (Test-Path "$dir/package.json" -PathType Leaf) {
        set-location $dir
        Write-Host -f Green "$dir ..."
        $null = yarn
    }

    $subDirs = Get-ChildItem -Path $dir -Directory -Force -ErrorAction SilentlyContinue
    foreach ($subDir in $subDirs) {
        if ($subDir.Name -ne "node_modules"){
            Install-Yarn-Recursive -dir $subDir
        }
    }
}

Write-Host -f Green `
  "`n==================================" `
  "`n=== Installing node_modules... ===" `
  "`n==================================`n"

$workDir = Get-Location

$repoRoot = [System.IO.Path]::GetFullPath((Join-Path $PSScriptRoot "../"))
Set-Location $repoRoot

Install-Yarn-Recursive -dir $repoRoot

Set-Location $workDir